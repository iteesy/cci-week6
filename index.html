<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8" />

    <title>CII Week 6</title>

    <!-- The website stylesheet -->
    <link rel="stylesheet" href="style.css" />

    <!-- The website JavaScript file -->
    <script src="script.js" defer></script>

  </head>

  <body>
    <h1>Web Audio Week!</h1>
    <a href="/helloworld/index.html">Hello World</a>
    <br>
    <a href="/player/index.html">File Playback</a>
    <br>
    <a href="/mic/index.html">Mic Playback (Intermediate)</a>
    <br>
    <a href="/synth/index.html">Synth (Simple)</a>
    <br>
    <a href="/effects/index.html">Effects</a>
    <br>
    <a href="/sampler/index.html">Sampler</a>
    <br>
    <a href="/tempo/index.html">Play Along (Quantize)</a>
    <br>
    <a href="/sequence/index.html">Sequence</a>
    <br>
    <a href="/sequencer/index.html">Pitch Sequencer (Intermediate)</a>
    <br>
    <a href="/drummachine/index.html">Drum Machine (Intermediate)</a>
    <br>
    <a href="/xy/index.html">XY Pad (Intermediate)</a>
    <a href="/sat-studio/index.html">5/17/25 Studio</a>

    <div class="container">
        <div class="controls">
            <button id="playButton" class="control-button">Play</button>
            <button id="kickButton" class="control-button">Kick</button>
            <button id="snareButton" class="control-button">Snare</button>
        </div>
        <div class="visual-container">
            <!-- <video id="backgroundVideo" autoplay loop muted playsinline>
                <source src="https://cdn.jsdelivr.net/gh/iteesy/cci-week6-updated@main/sequencer/background.mp4" type="video/mp4">
            </video> -->
            <canvas id="hydraCanvas"></canvas>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hydra-synth@1.3.0/dist/hydra-synth.min.js"></script>
    <script>
        // Wait for the page to load
        window.addEventListener('load', () => {
            // Initialize Hydra
            const hydra = new Hydra({
                canvas: document.getElementById('hydraCanvas'),
                detectAudio: false,
                width: window.innerWidth,
                height: window.innerHeight
            });

            // Hydra synthesis code
            voronoi(50,1)
                .luma(0.5).add(shape(1,1).luma(1))
                .modulate(osc(-1000,-1)
                    .modulate(osc().luma()))
                .blend(o0)
                .blend(o0)
                .blend(o0)
                .blend(o0)
                .out();

            // Initialize Tone.js
            const synth = new Tone.PolySynth(Tone.Synth).toDestination();
            const kick = new Tone.Player("https://cdn.jsdelivr.net/gh/iteesy/cci-week6-updated@main/sequencer/kick.wav").toDestination();
            const snare = new Tone.Player("https://cdn.jsdelivr.net/gh/iteesy/cci-week6-updated@main/sequencer/snare.wav").toDestination();

            // Melody sequence
            const melody = ["C4", "E4", "G4", "C5", "G4", "E4"];
            let currentNote = 0;
            let isPlaying = false;
            let intervalId;

            // Button click handlers
            document.getElementById('playButton').addEventListener('click', async () => {
                if (!isPlaying) {
                    await Tone.start();
                    isPlaying = true;
                    intervalId = setInterval(() => {
                        synth.triggerAttackRelease(melody[currentNote], "8n");
                        currentNote = (currentNote + 1) % melody.length;
                    }, 1000);
                } else {
                    clearInterval(intervalId);
                    isPlaying = false;
                }
            });

            document.getElementById('kickButton').addEventListener('click', async () => {
                await Tone.start();
                kick.start();
            });

            document.getElementById('snareButton').addEventListener('click', async () => {
                await Tone.start();
                snare.start();
            });
        });
    </script>

    <style>
        .container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .controls {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 2;
            display: flex;
            gap: 1rem;
        }

        .visual-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        #hydraCanvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
        }
    </style>
  </body>

</html>
